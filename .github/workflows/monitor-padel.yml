name: Monitor P√°del - Versi√≥n Corregida

on:
  workflow_dispatch:
  schedule:
    - cron: '50 0 * * 3'
    - cron: '0 1 * * 3'
    - cron: '10 1 * * 3'
    - cron: '20 1 * * 3'
    - cron: '30 1 * * 3'
    - cron: '40 1 * * 3'
    - cron: '50 1 * * 3'
    - cron: '0 2 * * 3'
    - cron: '10 2 * * 3'
    - cron: '20 2 * * 3'
    - cron: '30 2 * * 3'
    - cron: '0 9 * * 4'
    - cron: '15 9 * * 4'
    - cron: '30 9 * * 4'
    - cron: '45 9 * * 4'

jobs:
  monitor-padel:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout c√≥digo
      uses: actions/checkout@v4
    
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Instalar dependencias del sistema
      run: |
        sudo apt-get update
        sudo apt-get install -y wget
        
    - name: Instalar Chrome
      run: |
        wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
        echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
    
    - name: Instalar dependencias Python
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Verificar instalaciones
      run: |
        echo "Python versi√≥n:"
        python --version
        echo ""
        echo "Chrome versi√≥n:"
        google-chrome --version
        echo ""
        echo "webdriver-manager instalado"
    
    - name: Ejecutar monitor de reservas
      env:
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        USUARIO_CLUB: ${{ secrets.USUARIO_CLUB }}
        PASSWORD_CLUB: ${{ secrets.PASSWORD_CLUB }}
      run: |
        echo "üèì Iniciando monitor de reservas de p√°del..."
        python monitor.py
    
    - name: Reportar error si falla
      if: failure()
      run: |
        echo "‚ùå ERROR: El monitor fall√≥"
        echo "üìã Verifica:"
        echo "   1. URLs en monitor.py"
        echo "   2. Secrets en GitHub"
        echo "   3. Credenciales del club"
        echo "   4. Conectividad al sitio"
