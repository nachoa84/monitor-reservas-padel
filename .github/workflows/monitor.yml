name: ü§ñ Monitor Reservas P√°del

on:
  schedule:
    # ==============================================
    # HORARIOS DE EJECUCI√ìN (en UTC)
    # Argentina est√° en UTC-3 (restar 3 horas)
    # ==============================================
    
    # MI√âRCOLES - Noche (Argentina 21:50-23:59)
    - cron: '50 0 * * 4'    # Mi√© 21:50 ARG = Jue 00:50 UTC
    - cron: '0 1 * * 4'     # Mi√© 22:00 ARG = Jue 01:00 UTC
    - cron: '10 1 * * 4'    # Mi√© 22:10 ARG = Jue 01:10 UTC
    - cron: '20 1 * * 4'    # Mi√© 22:20 ARG = Jue 01:20 UTC
    - cron: '30 1 * * 4'    # Mi√© 22:30 ARG = Jue 01:30 UTC
    - cron: '40 1 * * 4'    # Mi√© 22:40 ARG = Jue 01:40 UTC
    - cron: '50 1 * * 4'    # Mi√© 22:50 ARG = Jue 01:50 UTC
    - cron: '0 2 * * 4'     # Mi√© 23:00 ARG = Jue 02:00 UTC
    - cron: '10 2 * * 4'    # Mi√© 23:10 ARG = Jue 02:10 UTC
    - cron: '20 2 * * 4'    # Mi√© 23:20 ARG = Jue 02:20 UTC
    - cron: '30 2 * * 4'    # Mi√© 23:30 ARG = Jue 02:30 UTC
    - cron: '40 2 * * 4'    # Mi√© 23:40 ARG = Jue 02:40 UTC
    - cron: '50 2 * * 4'    # Mi√© 23:50 ARG = Jue 02:50 UTC
    
    # JUEVES - Ma√±ana (Argentina 06:00-08:00)
    - cron: '0 9 * * 4'     # Jue 06:00 ARG = Jue 09:00 UTC
    - cron: '15 9 * * 4'    # Jue 06:15 ARG = Jue 09:15 UTC
    - cron: '30 9 * * 4'    # Jue 06:30 ARG = Jue 09:30 UTC
    - cron: '45 9 * * 4'    # Jue 06:45 ARG = Jue 09:45 UTC
    - cron: '0 10 * * 4'    # Jue 07:00 ARG = Jue 10:00 UTC
    - cron: '15 10 * * 4'    # Jue 07:15 ARG = Jue 10:15 UTC
    - cron: '30 10 * * 4'    # Jue 07:30 ARG = Jue 10:30 UTC
    - cron: '45 10 * * 4'    # Jue 07:45 ARG = Jue 10:45 UTC
    - cron: '0 11 * * 4'    # Jue 08:00 ARG = Jue 11:00 UTC
    
    # Verificaci√≥n extra: Jueves mediod√≠a
    - cron: '0 15 * * 4'    # Jue 12:00 ARG = Jue 15:00 UTC
    
  # Tambi√©n ejecutar manualmente desde GitHub
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest
    
    steps:
    - name: ‚¨áÔ∏è Descargar c√≥digo
      uses: actions/checkout@v3
    
    - name: üêç Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: üîß Instalar Chrome y ChromeDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y wget unzip
        wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
        echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
        CHROME_VERSION=$(google-chrome --version | cut -d ' ' -f3 | cut -d '.' -f1)
        wget -N https://storage.googleapis.com/chrome-for-testing-public/$CHROME_VERSION.0.0/linux64/chromedriver-linux64.zip
        unzip chromedriver-linux64.zip
        sudo mv chromedriver-linux64/chromedriver /usr/local/bin/
        sudo chmod +x /usr/local/bin/chromedriver
    
    - name: üì¶ Instalar dependencias Python
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ü§ñ Ejecutar Monitor
      env:
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        USUARIO_CLUB: ${{ secrets.USUARIO_CLUB }}
        PASSWORD_CLUB: ${{ secrets.PASSWORD_CLUB }}
      run: python monitor.py
    
    - name: üìä Mostrar logs si falla
      if: failure()
      run: |
        echo "‚ùå La ejecuci√≥n fall√≥"
        echo "Revisa los logs arriba"
