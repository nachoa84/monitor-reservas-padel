name: Monitor Reservas Pádel

on:
  workflow_dispatch:
  schedule:
    - cron: '50 0 * * 3'
    - cron: '0 1 * * 3'
    - cron: '10 1 * * 3'
    - cron: '20 1 * * 3'
    - cron: '30 1 * * 3'
    - cron: '40 1 * * 3'
    - cron: '50 1 * * 3'
    - cron: '0 2 * * 3'
    - cron: '10 2 * * 3'
    - cron: '20 2 * * 3'
    - cron: '30 2 * * 3'
    - cron: '0 9 * * 4'
    - cron: '15 9 * * 4'
    - cron: '30 9 * * 4'
    - cron: '45 9 * * 4'

jobs:
  monitor:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout código
      uses: actions/checkout@v4
    
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Instalar Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y wget
        wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
        echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
    
    - name: Instalar dependencias Python
      run: |
        pip install -r requirements.txt
    
    - name: Verificar instalaciones
      run: |
        python --version
        google-chrome --version
        echo "Chrome instalado"
    
    - name: Ejecutar monitor
      env:
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        USUARIO_CLUB: ${{ secrets.USUARIO_CLUB }}
        PASSWORD_CLUB: ${{ secrets.PASSWORD_CLUB }}
      run: |
        python monitor.py
